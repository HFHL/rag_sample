<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RAG Chat</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; margin: 24px; }
    #container { max-width: 920px; margin: 0 auto; }
    textarea { width: 100%; height: 120px; }
    button { padding: 8px 16px; }
    .ctx { background: #f7f7f9; border: 1px solid #eee; padding: 8px; margin: 8px 0; white-space: pre-wrap; }
    .answer { white-space: pre-wrap; border-left: 4px solid #4caf50; padding-left: 12px; }
  </style>
  </head>
<body>
  <div id="container">
    <h2>RAG Chat</h2>
    <textarea id="query" placeholder="请输入问题..."></textarea>
    <br/>
    <button id="send">发送</button>
    <hr/>
    <div>
      <h3>Answer</h3>
      <div id="answer" class="answer"></div>
    </div>
    <div>
      <h3>Contexts</h3>
      <div id="contexts"></div>
    </div>
  </div>
  <script>
    document.getElementById('send').addEventListener('click', async () => {
      const query = document.getElementById('query').value.trim();
      if (!query) return;
      document.getElementById('answer').textContent = '正在生成...';
      document.getElementById('contexts').innerHTML = '';
      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query })
        });
        const data = await res.json();
        if (data.error) {
          document.getElementById('answer').textContent = data.error;
          return;
        }
        document.getElementById('answer').textContent = data.answer || '';
        const ctxContainer = document.getElementById('contexts');
        (data.contexts || []).forEach((c, idx) => {
          const div = document.createElement('div');
          div.className = 'ctx';
          div.textContent = `[${idx+1}] ${c.id}\n` + (c.text || '');
          ctxContainer.appendChild(div);
        });
      } catch (e) {
        document.getElementById('answer').textContent = '请求失败';
      }
    });
  </script>
</body>
</html>


